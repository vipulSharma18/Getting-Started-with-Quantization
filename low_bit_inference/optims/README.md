This file mostly contains code from hugging face transformers.

I created a local copy to patch and bugfix the code, and to extract the relevant bits so that it could be a target for future work with custom kernels for these components.